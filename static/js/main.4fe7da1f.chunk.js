(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){},106:function(e,t,a){"use strict";a.r(t);var n=a(4),c=a(1),i=a.n(c),s=a(33),r=a.n(s),o=(a(89),a(16)),l=(a(90),a(14)),d=(a(91),a(9)),j=(a(92),a(128)),u=Object(c.forwardRef)((function(e,t){var a=e.content,c=e.creationTime,i=e.authorPhoto,s=e.authorName,r=(e.authorUid,e.incomming),o=Object(d.a)(e,["content","creationTime","authorPhoto","authorName","authorUid","incomming"]);return Object(n.jsx)("div",Object(l.a)(Object(l.a)({},o),{},{children:Object(n.jsxs)("div",{ref:t,className:"message ".concat(!r&&"message--incomming"),children:[Object(n.jsxs)("div",{className:"message__top",children:[Object(n.jsx)("div",{className:"message__text",children:a}),Object(n.jsx)(j.a,{src:i,className:"message__avatar"})]}),Object(n.jsxs)("p",{className:"message__data",children:[c," ",s]})]})}))})),b=a(42),h=a.n(b),m=a(75),f=a.n(m),O=a(124),x=a(61),v=x.a.initializeApp({apiKey:"AIzaSyCcF5qvHgJJSddX9b1iV-J-vsnuFkc8YhQ",authDomain:"imessage-clone-60028.firebaseapp.com",projectId:"imessage-clone-60028",storageBucket:"imessage-clone-60028.appspot.com",messagingSenderId:"857061839877",appId:"1:857061839877:web:9e643870c4d96895a3f86c"}).firestore(),p=x.a.auth(),g=new x.a.auth.GoogleAuthProvider,N=v,y=a(13),C=a(44),_=Object(C.b)({name:"user",initialState:{user:null},reducers:{login:function(e,t){e.user=t.payload},logout:function(e){e.user=null}}}),E=_.actions,w=E.login,S=E.logout,k=function(e){return e.user.user},A=_.reducer,T=Object(C.b)({name:"chat",initialState:{open:!1,name:"",id:"NOPE",creationTime:"",testData:{}},reducers:{openChatAction:function(e,t){e.open=!0;var a=t.payload,n=a.name,c=a.id,i=a.creationTime,s=a.lastAvatar,r=a.lastEdit,o=a.lastName,l=a.creatorUid;e.name=n,e.id=c,e.creationTime=i,e.lastAvatar=s,e.lastEdit=r,e.lastName=o,e.creatorUid=l},updateChatAction:function(e,t){e.testData=Object(l.a)(Object(l.a)({},e),t.payload),e.lastEdit=t.payload.lastEdit,e.lastName=t.payload.lastName,e.lastAvatar=t.payload.lastAvatar,e.name=t.payload.name,e.creatorUid=t.payload.creatorUid,e.id=t.payload.id},closeChatAction:function(e){e.open=!1}}}),D=T.actions,R=D.openChatAction,U=D.updateChatAction,L=D.closeChatAction,Y=function(e){return e.chat},B=T.reducer,M=a(27),z=a.n(M),H=function(e){return"string"===typeof e?function(e){return z()(e,"DD.MM.YYYY HH.mm.ss")}(e):e instanceof Date?z()(e):z()(e.toDate())},I=function(e){return e.format("DD/MM/YYYY, HH:mm:ss")},P=a(60),q=a.n(P),J={backgroundColor:"white",borderRadius:"14px 14px 0 0",overflow:"hidden",width:"96vw",display:"flex",justifyContent:"center",marginTop:"30px",marginLeft:"auto",marginRight:"auto",height:"calc(100% - 30px)",opacity:1},F=i.a.forwardRef((function(e,t){var a=e.open,i=e.handleClose,s=e.children,r=(Object(d.a)(e,["open","handleClose","children"]),Object(c.useRef)([]),Object(c.useState)(!1)),l=Object(o.a)(r,2),j=(l[0],l[1]);return Object(c.useEffect)((function(){return j(a),function(){}}),[a]),Object(n.jsx)("div",{style:J,ref:t,children:Object(n.jsxs)("div",{className:q.a.Container,children:[Object(n.jsx)("div",{onClick:i,className:q.a.Top,children:Object(n.jsx)("h4",{children:"Done"})}),Object(n.jsx)("div",{className:q.a.Content,children:s})]})})})),W=a(74),G=a.n(W),K=function(e){return Object(n.jsx)("div",{className:"rounded-[14px] sm:w-[640px] mt-4 my-0 p-4 w-full",children:e.children})},Q=function(e){return Object(n.jsx)("div",{className:"rounded-[14px] bg-imessage-gray sm:w-[640px] mt-4 p-4 w-full",children:e.children})},X=function(e){var t=e.className,a=(e.disable,Object(d.a)(e,["className","disable"]));return Object(n.jsx)("div",Object(l.a)(Object(l.a)({className:"rounded-[14px] bg-imessage-gray mt-4 p-4 px-8 ".concat(t)},a),{},{children:a.children}))},V=function(e){var t=Object.assign({},e);return Object(n.jsx)("div",Object(l.a)(Object(l.a)({className:"flex items-center justify-between w-full py-2 border-b border-gray-300 last:pb-0 first:pt-0 last:border-0"},t),{},{children:t.children}))},Z=function(e){var t=e.type,a=void 0===t?"normal":t,c=Object(d.a)(e,["type"]);switch(a){case"edit":return Object(n.jsx)("p",{className:"font-normal text-gray-700",children:c.children});default:return Object(n.jsx)("p",{className:"font-bold text-gray-700",children:c.children})}},$=function(e){var t=e.type,a=void 0===t?"normal":t,c=Object(d.a)(e,["type"]);switch(a){case"edit":return Object(n.jsx)("p",{className:"flex-grow pl-4 text-base text-gray-600 break-all",children:c.children});default:return Object(n.jsx)("p",{className:"pl-4 text-sm text-right text-gray-600 break-all",children:c.children})}return Object(n.jsx)("p",{className:"pl-4 text-sm text-right text-gray-600 break-all",children:c.children})},ee=a(127),te=a(126),ae=i.a.forwardRef((function(e,t){var a,s=e.open,r=e.handleClose,l=i.a.useRef(),d=i.a.useRef(null),j=Object(c.useState)(""),u=Object(o.a)(j,2),b=u[0],m=u[1],f=Object(y.c)(k),O=Object(y.c)(Y),x=Object(y.b)(),v=Object(c.useState)(!0),p=Object(o.a)(v,2),g=p[0],C=p[1];Object(c.useEffect)((function(){m(O.name)}),[]),Object(c.useEffect)((function(){C(b.length<4)}),[b]);var _=Object(c.useCallback)((function(e){null===e||void 0===e||e.focus()}),[s]),E=Object(c.useState)(O.creatorUid===f.uid),w=Object(o.a)(E,2),S=w[0];w[1];return Object(n.jsx)(F,{open:s,handleClose:r,ref:l,children:Object(n.jsxs)("div",{className:G.a.Container,ref:d,children:[Object(n.jsxs)(K,{children:[Object(n.jsx)("div",{className:"text-xl font-extrabold text-center",children:O.name}),Object(n.jsx)("div",{className:"text-xs font-light text-center text-imessage-dark-gray-2",children:O.creatorUid===f.uid?"You've created this chat. You can edit.":""})]}),S&&Object(n.jsx)(Q,{children:Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{type:"edit",children:"Chat Name"}),Object(n.jsx)("form",{onSubmit:function(e){e.preventDefault(),b.length>=4?(!function(e){var t;null===(t=N.collection("chats"))||void 0===t||t.doc(O.id).set({name:e},{merge:!0})}(b),r()):C(!1)},className:"flex-1 ml-10",children:Object(n.jsxs)("div",{className:"flex items-center justify-between w-full",children:[Object(n.jsx)("input",{ref:_,className:"flex-grow bg-transparent border-0 border-transparent border-black focus-visible:outline-none",value:b,disable:!S,onChange:function(e){m(e.target.value)}}),Object(n.jsx)(ee.a,{exitBeforeEnter:!0,children:g?Object(n.jsx)(te.a.div,{initial:{x:"200px"},animate:{opacity:1,x:"0px"},exit:{opacity:0,x:"200px"},className:"flex-shrink-0 text-xs text-red-600 opacity-0 justify-self-end",children:"Name is too short."},g):Object(n.jsx)("button",{type:"submit",className:"p-0",children:Object(n.jsx)(h.a,{color:g?"disabled":"primary"})})})]})})]})}),Object(n.jsxs)(Q,{children:[Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"Chat Name"}),Object(n.jsx)($,{children:O.name})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"ID"}),Object(n.jsx)($,{children:O.id})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"creationTime"}),Object(n.jsx)($,{children:O.creationTime})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"creatorUid"}),Object(n.jsx)($,{children:null===O||void 0===O?void 0:O.creatorUid})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"lastEdit"}),Object(n.jsx)($,{children:O.lastEdit})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"lastEdit Relative"}),Object(n.jsx)($,{children:z()(O.lastEdit,"DD/MM/YYYY, h:mm:ss").fromNow()})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"lastName"}),Object(n.jsx)($,{children:O.lastName})]}),Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{children:"lastAvatar"}),Object(n.jsx)($,{children:null===O||void 0===O||null===(a=O.lastAvatar)||void 0===a?void 0:a.slice(0,150)})]})]}),S&&Object(n.jsx)(X,{onClick:S?function(e){var t;null===(t=N.collection("chats"))||void 0===t||t.doc(O.id).delete().then((function(){console.log("Document successfully deleted!"),x(L()),r()})).catch((function(e){console.error("Error removing document :( ): ",e)}))}:null,className:"transition-all duration-150 hover:bg-imessage-dark-gray",children:Object(n.jsx)(V,{className:"font-bold ".concat(S?"text-red-600":"text-gray-400"),children:"Delete"})})]})})})),ne=(a(108),a(5)),ce=i.a.forwardRef((function(e,t){e.open;var a=e.handleClose,s=e.children,o=(Object(d.a)(e,["open","handleClose","children"]),Object(c.useRef)()),l=(Object(c.useRef)(),Object(c.useRef)(!0)),j=function(e){var t,a;if(!(null===(t=o.current)||void 0===t||null===(a=t.children[0])||void 0===a?void 0:a.contains(e.target))){if(l.current)return void(l.current=!1);b()}};Object(c.useEffect)((function(){return document.addEventListener("click",j),function(){document.removeEventListener("click",j)}}),[]);var u=function(e){("key"in e?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&a()};Object(c.useEffect)((function(){return document.addEventListener("keydown",u),function(){document.removeEventListener("keydown",u)}}),[]),i.a.useLayoutEffect((function(){ne.w.from(o.current,{opacity:0,duration:.3}),ne.w.from(o.current.children,{y:"100%",duration:.6})}),[]);var b=function(){ne.w.to(o.current,{backgroundColor:"transparent",duration:1,onComplete:a}),ne.w.to(o.current.children,{y:"100%",duration:.6})};Object(c.useRef)([]);return r.a.createPortal(Object(n.jsx)("div",{ref:o,className:"absolute top-0 left-0 z-50 w-full h-full overflow-hidden bg-black bg-opacity-50",children:Object(n.jsx)(n.Fragment,{children:i.a.cloneElement(s,{handleClose:b})})}),document.body)})),ie=a(65);var se=function(){var e=Object(y.c)(k),t=Object(y.c)(Y),a=Object(y.b)(),i=Object(c.useState)(""),s=Object(o.a)(i,2),r=s[0],d=s[1],j=Object(c.useState)([]),b=Object(o.a)(j,2),m=b[0],x=b[1];Object(c.useEffect)((function(){var e,a,n=null;t.open&&(n=null===(e=N.collection("chats"))||void 0===e||null===(a=e.doc(t.id))||void 0===a?void 0:a.collection("messages").onSnapshot((function(e){var t,a=v(null===(t=e.docs)||void 0===t?void 0:t.map((function(e){return Object(l.a)(Object(l.a)({},e.data()),{},{id:e.id,creationTime:H(e.data().creationTime)})})));x(a)})));return function(){t.open&&n()}}),[t]),Object(c.useEffect)((function(){return w(!1),function(){}}),[t]);var v=function(e){return e.sort((function(e,t){return z()(e.creationTime)-z()(t.creationTime)}))},p=Object(c.createRef)(),g=Object(c.createRef)(),C=Object(c.useState)(!1),_=Object(o.a)(C,2),E=_[0],w=_[1];Object(c.useEffect)((function(){g.current&&g.current.scrollBy(0,g.current.scrollHeight),E&&(console.log("isMessageSent",E),ie.a.from(p.current,{opacity:0,height:0,duration:.5}))}),[m]);var S=Object(c.useState)(!1),A=Object(o.a)(S,2),T=A[0],D=A[1];return Object(n.jsxs)("div",{className:"chat",children:[Object(n.jsxs)("div",{className:"chat__header",children:[Object(n.jsx)(O.a,{onClick:function(){a(L()),x([])},children:Object(n.jsx)(f.a,{})}),Object(n.jsx)("div",{className:"header__chat-name",children:Object(n.jsx)("h4",{children:t.open?t.name:""})}),Object(n.jsx)("h4",{onClick:function(){D(!0)},className:"chat__details",children:"Details"})]}),Object(n.jsx)("div",{ref:g,className:"".concat(!t.open&&"bg-gray-200"," chat__messages"),children:m.map((function(t,a){return Object(n.jsx)("div",{children:Object(n.jsx)(u,Object(l.a)(Object(l.a)({incomming:t.authorUid===e.uid,content:t.content},t),{},{creationTime:I(t.creationTime),ref:p}),a)},a)}))}),t.open&&Object(n.jsx)("div",{className:"chat__input",children:Object(n.jsxs)("form",{onSubmit:function(a){t.open?function(a){a.preventDefault(),w(!0);try{var n,c;null===(n=N.collection("chats"))||void 0===n||null===(c=n.doc(t.id))||void 0===c||c.collection("messages").add({authorName:e.displayName,authorUid:e.uid,authorPhoto:e.photo,content:r,creationTime:new Date}).then((function(){var a,n=new Date;null===(a=N.collection("chats"))||void 0===a||a.doc(t.id).update({lastEdit:n,lastName:e.displayName,lastAvatar:e.photo}).then((function(e){})).catch((function(e){console.log("error przy edycji chatu (zmiana ostatnich) ",e)}))})).catch((function(e){console.log("ERROR",e)}))}catch(a){console.log("ERROR",a)}d("")}(a):(a.preventDefault(),d(""))},className:"chat__input-wrapper",children:[Object(n.jsx)("input",{value:r,onChange:function(e){return d(e.target.value)},placeholder:"Message",disabled:!t.open}),Object(n.jsx)(O.a,{type:"submit",onClick:function(){},children:Object(n.jsx)(h.a,{})})]})}),T&&Object(n.jsx)(ce,{open:T,handleClose:function(){D(!1)},children:Object(n.jsx)(ae,{open:T})})]})},re=a(34);a(102),a(103);var oe=function(e){var t=e.name,a=e.lastEdit,c=e.lastName,i=e.lastAvatar,s=e.isActive;return Object(n.jsxs)("div",{className:"sidebarChat ".concat(s&&"sidebarChat--active"),children:[Object(n.jsx)(j.a,{className:"sidebarChat__avatar",src:i}),Object(n.jsxs)("div",{className:"sidebarChat__info",children:[Object(n.jsxs)("div",{className:"sidebarChat__info-1",children:[Object(n.jsx)("div",{className:"sidebarChat__name",children:t}),Object(n.jsx)("div",{className:"sidebarChat__date",children:I(H(a))})]}),Object(n.jsx)("div",{className:"sidebarChat__info-2",children:c})]})]})},le=a(77),de=a.n(le),je=a(78),ue=a.n(je),be=a(76),he=a.n(be),me=i.a.forwardRef((function(e,t){var a=e.open,i=e.handleClose,s=Object(c.useState)(""),r=Object(o.a)(s,2),d=r[0],j=r[1],u=Object(c.useState)(!0),b=Object(o.a)(u,2),m=b[0],f=b[1],O=Object(y.c)(k),x=Object(y.b)(),v=Object(c.useCallback)((function(e){null===e||void 0===e||e.focus(),console.dir(e)}),[]);return Object(n.jsx)(F,{open:a,handleClose:i,ref:t,children:Object(n.jsxs)("div",{className:he.a.Container,children:[Object(n.jsx)(K,{children:Object(n.jsx)("div",{className:"text-xl font-extrabold text-center",children:"New"})}),Object(n.jsx)(Q,{children:Object(n.jsxs)(V,{children:[Object(n.jsx)(Z,{type:"edit",children:"Chat Name"}),Object(n.jsx)("form",{onSubmit:function(e){var t;e.preventDefault(),d.length>3?(console.log("handle change on submit: "+d),t=d,N.collection("chats").add({lastName:O.displayName,lastEdit:new Date,lastAvatar:O.photo,creationTime:new Date,creatorName:O.displayName,creatorAvatar:O.photo,creatorUid:O.uid,name:t}).then((function(e){console.log("NEW CHAT ADDED "+e.id),console.dir(e.id),e.get().then((function(e){x(R(Object(l.a)(Object(l.a)({id:e.id},e.data()),{},{lastEdit:I(H(e.data().lastEdit)),creationTime:I(H(e.data().creationTime)),data:null})))}))})),j(""),i()):f(!1)},className:"flex-1 ml-10",children:Object(n.jsxs)("div",{className:"flex items-center justify-between w-full",children:[Object(n.jsx)("input",{ref:v,className:"flex-grow bg-transparent border-0 border-transparent border-black focus-visible:outline-none",value:d,onChange:function(e){j(e.target.value),d.length<=3?f(!0):f(!1)}}),m?Object(n.jsx)("div",{className:"flex-shrink-0 text-xs text-red-600 justify-self-end",children:"The name is too short. Correct it."}):Object(n.jsx)("button",{type:"submit",className:"p-0",children:Object(n.jsx)(h.a,{color:m?"disabled":"primary"})})]})})]})})]})})}));var fe=function(){var e=Object(y.c)(k),t=Object(y.c)(Y),a=Object(y.b)(),i=(Object(y.c)((function(e){return e.chat.id})),Object(c.useState)([])),s=Object(o.a)(i,2),r=s[0],d=s[1];Object(c.useEffect)((function(){var e=N.collection("chats").onSnapshot((function(e){var t,a=u(null===(t=e.docs)||void 0===t?void 0:t.map((function(e){var t;return Object(l.a)(Object(l.a)({id:e.id},e.data()),{},(t={name:e.data().name,lastAvatar:e.data().lastAvatar,lastName:e.data().lastName,creationTime:e.data().creationTime,lastEdit:e.data().lastEdit?H(e.data().lastEdit):H(e.data().creationTime)},Object(re.a)(t,"name",e.data().name),Object(re.a)(t,"data",e.data()),t))})));d(a)}));return function(){e()}}),[]),Object(c.useEffect)((function(){var e=r.find((function(e){return e.id===t.id}));if(e){var n=e.lastEdit,c=e.lastName,i=e.lastAvatar,s=e.name,o=e.creatorUid,l=e.id;a(U({lastEdit:I(H(n)),lastName:c,lastAvatar:i,name:s,creatorUid:o,id:l}))}}),[r]);var u=function(e){return e.sort((function(e,t){return z()(t.lastEdit)-z()(e.lastEdit)}))},b=Object(c.useState)(!1),h=Object(o.a)(b,2),m=h[0],f=h[1],x=Object(c.useState)(""),v=Object(o.a)(x,2),g=v[0],C=v[1];return Object(n.jsxs)("div",{className:"sidebar",children:[Object(n.jsxs)("div",{className:"sidebar__header",children:[Object(n.jsx)(j.a,{onClick:function(){return p.signOut()},src:e.photo,className:"sidebar__avatar"}),Object(n.jsxs)("div",{className:"sidebar__search",children:[Object(n.jsx)(de.a,{}),Object(n.jsx)("input",{placeholder:"Search",onChange:function(e){return C(e.target.value)}})]}),Object(n.jsx)(O.a,{variant:"outlined",className:"sidebar__input-buttton",children:Object(n.jsx)(ue.a,{onClick:function(){f(!0)}})})]}),Object(n.jsx)("div",{className:"sidebar__chats",children:r.filter((function(e){return""===g||!!e.name.toLowerCase().includes(g.toLowerCase())})).map((function(e,c){return Object(n.jsx)("div",{onClick:function(){!function(e){a(R(Object(l.a)(Object(l.a)({},e),{},{lastEdit:I(H(e.lastEdit)),creationTime:I(H(e.creationTime)),data:null})))}(e)},children:Object(n.jsx)(oe,{name:e.name,lastEdit:I(e.lastEdit),lastName:e.lastName,lastAvatar:e.lastAvatar,isActive:e.id===t.id})},e.id)}))}),m&&Object(n.jsx)(ce,{open:m,handleClose:function(){f(!1)},children:Object(n.jsx)(me,{open:m,handleClose:function(){f(!1)}})})]})};var Oe=function(){var e=Object(c.useState)(window.innerWidth),t=Object(o.a)(e,2),a=t[0],i=t[1],s=(Object(y.c)(k),Object(y.c)(Y));return Object(c.useEffect)((function(){var e=function(e){i(window.innerWidth)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(n.jsxs)("div",{className:"imessage",children:[a>=640&&Object(n.jsxs)(n.Fragment,{children:[" ",Object(n.jsx)(fe,{}),Object(n.jsx)(se,{})]}),a<640&&(s.open?Object(n.jsx)(se,{}):Object(n.jsx)(fe,{}))]})},xe=(a(104),a.p+"static/media/imessage-logo.2ee5a3f6.png"),ve=a(125),pe=function(){return Object(n.jsxs)("div",{className:"login",children:[Object(n.jsx)("div",{className:"login__logo",children:Object(n.jsx)("img",{src:xe})}),Object(n.jsx)("h1",{children:"iMessage"}),Object(n.jsx)(ve.a,{onClick:function(){p.signInWithPopup(g).catch((function(e){alert(e.message)}))},children:"Sign In"})]})};a(105);var ge=function(){var e=Object(y.c)(k),t=Object(y.b)(),a=function(){document.querySelector(":root").style.setProperty("--vh",window.innerHeight/100+"px")};return Object(c.useEffect)((function(){return window.addEventListener("resize",a),a(),function(){window.removeEventListener("resize",a)}}),[]),Object(c.useEffect)((function(){p.onAuthStateChanged((function(e){t(e?w({uid:e.uid,photo:e.photoURL,emiall:e.emiall,displayName:e.displayName}):S())}))}),[]),Object(n.jsx)("div",{className:"App",children:e?Object(n.jsx)(Oe,{}):Object(n.jsx)(pe,{})})},Ne=Object(C.a)({reducer:{user:A,chat:B}});r.a.render(Object(n.jsx)(i.a.StrictMode,{children:Object(n.jsx)(y.a,{store:Ne,children:Object(n.jsx)(ge,{})})}),document.getElementById("root"))},60:function(e,t,a){e.exports={Container:"BottomSheet_Container__Qsc_G",Top:"BottomSheet_Top__LR-l3",Content:"BottomSheet_Content__1JF1q"}},74:function(e,t,a){e.exports={Container:"EditChatBS_Container__13qRe",Element:"EditChatBS_Element__ky8qA",detailsElement:"EditChatBS_detailsElement__3IBgm"}},76:function(e,t,a){e.exports={Container:"NewChatBS_Container__1KLSP",Element:"NewChatBS_Element__HCqXf",detailsElement:"NewChatBS_detailsElement__umNTZ"}},89:function(e,t,a){},90:function(e,t,a){},91:function(e,t,a){},92:function(e,t,a){}},[[106,1,2]]]);
//# sourceMappingURL=main.4fe7da1f.chunk.js.map